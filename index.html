<?php
    session_start();
    include_once('conexao.php');
    if((!isset($_SESSION['usuario']) == true) and (!isset($_SESSION['senha']) == true) and (!isset($_SESSION['privilegio']) == true)) {
        unset($_SESSION['usuario']);
        unset($_SESSION['senha']);
        unset($_SESSION['privilegio']);
        header('Location: login.php');
    }
    $logado = $_SESSION['usuario'];
?>
<!doctype html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>E2S</title>    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <link href="css/style.css" rel="stylesheet">
    <link rel="shortcut icon" type="imagex/png" href="img/icone.ico">
<script>
    function limpa_formulário_cep() { //Limpa valores do formulário de cep.           
            document.getElementById('rua').value=("");
            document.getElementById('bairro').value=("");
    }
    function meu_callback(conteudo) {
        if (!("erro" in conteudo)) {//Atualiza os campos com os valores.
            document.getElementById('rua').value=(conteudo.logradouro);
            document.getElementById('bairro').value=(conteudo.bairro);
        }
        else {//CEP não Encontrado.            
            limpa_formulário_cep();
            alert("CEP não encontrado.");
        }
    }
        
    function pesquisacep(valor) {
        //Nova variável "cep" somente com dígitos.
        var cep = valor.replace(/\D/g, '');
        //Verifica se campo cep possui valor informado.
        if (cep != "") {
            //Expressão regular para validar o CEP.
            var validacep = /^[0-9]{8}$/;
            //Valida o formato do CEP.
            if(validacep.test(cep)) {
                //Preenche os campos com "..." enquanto consulta webservice.
                document.getElementById('rua').value="...";
                document.getElementById('bairro').value="...";
                //Cria um elemento javascript.
                var script = document.createElement('script');
                //Sincroniza com o callback.
                script.src = 'https://viacep.com.br/ws/'+ cep + '/json/?callback=meu_callback';
                //Insere script no documento e carrega o conteúdo.
                document.body.appendChild(script);
            }
            else {//cep é inválido.
                limpa_formulário_cep();
                alert("Formato de CEP inválido.");
            }
        }
        else { //cep sem valor, limpa formulário.
            limpa_formulário_cep();
        }
    };
</script>
</head>
<body class="bg-light">
<main>
<header class="py-5 text-center"><!--TOPO DA PÁGINA-->
  <div class="logomarca"> 
    <img class="d-block mx-auto mb-4" src="img/logo.png" alt="" width="85" height="50">
    <h4>AR E2S CORRETORA DE SEGUROS LTDA-ME</h4>
  </div>
  <div class="heading">
    <h2>Solicitar Certificado Digital</h2>
    <p class="lead">Faça a solicitação do certificado digital para seus clientes. Lembre de preencher todos os campos e conferir as informações.</p>    
    <p class="lead">Orientações:</p>
    <ul >
      <li>Preencha todos os campos obrigatórios.</li>
      <li>Confira se os dados estão corretos.</li>
      <li>Envie todos os documentos requisitados.</li>
    </ul>
  </div> 

  <style>
    .heading {

  margin: 45px auto 25px auto;
}
  </style>
</header>
<h2 class="text-center">Olá, <strong><?php echo $logado; ?></strong>. Seja bem vindo(a).</h2>
</div>
<?php
  if (isset($_SESSION['solicitacaoSucesso'])) {
      echo $_SESSION['solicitacaoSucesso'];
      unset($_SESSION['solicitacaoSucesso']);
  }
  ?>
<form class="needs-validation" method="post" action="solicitar_sucesso.php" enctype="multipart/form-data" novalidate>
    <!--ESCOLHAS PARA O TIPO E VALOR DO CERTIFICADO SELECIONADO-->
    <div class="select-cert">
      <label for="type-cpf" class="form-label">Tipo do Certificado</label>
      <select name="tipo-certificado" class="form-select" id="type-cpf" required>
        <option value="">Escolha o certificado</option>
        <option>R$ 135,00 E-CPF A1 Mídia Digital</option>
        <option>R$ 190,00 E-CPF A3 Cartão 1 ano</option>
        <option>R$ 230,00 E-CPF A3 Cartão 2 anos</option>
        <option>R$ 265,00 E-CPF A3 Cartão 3 anos</option>
        <option>R$ 300,00 E-CPF A3 Cartão + Leitora 1 ano</option>
        <option>R$ 330,00 E-CPF A3 Cartão + Leitora 2 anos</option>
        <option>R$ 365,00 E-CPF A3 Cartão + Leitora 3 anos</option>
        <option>R$ 135,00 E-CPF A3 sem mídia 1 ano</option>
        <option>R$ 175,00 E-CPF A3 sem mídia 2 anos</option>
        <option>R$ 210,00 E-CPF A3 sem mídia 3 anos</option>
        <option>R$ 210,00 E-CNPJ A1 Mídia Digital</option>
        <option>R$ 190,00 E-CNPJ A3 Cartão 1 ano</option>
        <option>R$ 230,00 E-CNPJ A3 Cartão 2 anos</option>
        <option>R$ 265,00 E-CNPJ A3 Cartão 3 anos</option>
        <option>R$ 300,00 E-CNPJ A3 Cartão + Leitora 1 ano</option>
        <option>R$ 330,00 E-CNPJ A3 Cartão + Leitora 2 anos</option>
        <option>R$ 365,00 E-CNPJ A3 Cartão + Leitora 3 anos</option>
        <option>R$ 135,00 E-CNPJ A3 sem mídia 1 ano</option>
        <option>R$ 175,00 E-CNPJ A3 sem mídia 2 anos</option>
        <option>R$ 210,00 E-CNPJ A3 sem mídia 3 anos</option>
      </select><div class="invalid-feedback">Selecione um tipo de certificado.</div>
      </div>

      <div class="input-info"><!--NOME DO CLIENTE-->
        <label for="nome-cliente" class="form-label">Nome Completo</label>
        <input name="nome" type="text" class="form-control" id="nome-cliente" required>
        <div class="invalid-feedback">Insira o nome do cliente.</div>
      </div>

      <section>
        <div class="input-info"><!--CPF DO CLIENTE-->
          <label for="cpf-cliente" class="form-label">CPF</label>
          <input name="cpf" type="text" class="form-control" id="cpf-cliente" required>
          <div class="invalid-feedback">Insira o CPF do cliente.</div>
        </div>

        <div class="input-info"><!--DATA NASCIMENTO DO CLIENTE-->
          <label for="data-cliente" class="form-label">Data Nascimento</label>
          <input name="data-nascimento" type="date" class="form-control" id="data-cliente" required>
          <div class="invalid-feedback">Insira a data de nascimento do cliente.</div>
        </div>
      </section>

      <section>
        <div class="input-info"><!--EMAIL DO CLIENTE-->
          <label for="email-cliente" class="form-label">Email</label>
          <input name="email" type="email" class="form-control" id="email-cliente" required>
          <div class="invalid-feedback">Insira o email do cliente.</div>
        </div>

        <div class="input-info"><!--TELEFONE DO CLIENTE-->
          <label for="endereco-cliente" class="form-label">Telefone</label>
          <input name="telefone" type="text" class="form-control" id="telefone-cliente" required>
          <div class="invalid-feedback">Insira o telefone do cliente.</div>
        </div>
      </section>

      <section>
        <div class="input-info"><!--CEP DO CLIENTE-->
          <label for="cep-cliente" class="form-label">CEP<span class="text-muted"></span></label>
          <input name="cep" type="text" id="cep" class="form-control" value="" size="10" maxlength="9"
                  onblur="pesquisacep(this.value);" required/>   
          <div class="invalid-feedback">Insira um CEP válido.</div>
        </div>

        <div class="input-info"><!--BAIRRO DO CLIENTE-->
          <label for="bairro-cliente" class="form-label">Bairro<span class="text-muted"></span></label>
          <input name="bairro" type="text" id="bairro" class="form-control" size="40" required/>
          <div class="invalid-feedback">Insira o Bairro.</div>
        </div>
      </section>

      <section>
        <div class="input-info"><!--RUA DO CLIENTE-->
          <label for="rua-cliente" class="form-label">Rua (Logradouro)</label>
          <input name="rua" type="text" id="rua" class="form-control" size="80" required/>    
          <div class="invalid-feedback">Insira a rua do cliente.</div>
        </div>

        <div class="input-info" id="num"><!--NUM DO CLIENTE-->
          <label for="num-cliente" class="form-label">N°<span class="text-muted"></span></label>
          <input name="num" type="number" class="form-control" id="num-cliente" required>
          <div class="invalid-feedback">Insira o número.</div>
        </div>        
      </section>
           
      <div class="observacoes"><!--OBSERVACOES CLIENTE-->
        <label for="obs-cliente" class="form-label">OBSERVACOES</label>
        <input name="observacoes" type="textarea" class="form-control" id="obs-cliente">
      </div>

      <div class="col-sm-10 mx-auto text-center"><!--DOC. PESSOAL DO CLIENTE-->
        <label for="doc-cliente" class="form-label">Anexar documento pessoal (CNH, RG ou DNI) e documentos da empresa ou pessoa jurídica (no caso de E-cnpj) </label>
        <input type="file" name="documentos[]" multiple="multiple" class="form-control" id="doc-cliente" name="sendDocs" required>
        <div class="invalid-feedback">É necessário anexar os documentos do cliente.</div>
      </div><hr class="my-4">
      <input class="w-100 btn btn-lg btn-primary" type="submit" name="btnSolicitar" value="Solicitar Certificado">
    </form>
</main>  
<footer class="my-5 pt-5 text-muted text-center text-small">
  <p class="mb-1">&copy; <?php echo date("Y");?> - AR E2S Corretora de Seguros LTDA-ME</p>
  <p>Site desenvolvido por<a href="https://www.linkedin.com/in/rafaelcarvalho-ti"> Rafael Carvalho</a></p>
</footer>
</div>
<script src="js/form-validation.js"></script>
</body>
</html>